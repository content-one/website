
<link rel="preload" as="style" href="/assets/theme.css" crossorigin="anonymous">
<link rel="stylesheet" id="theme-css" href="/assets/theme.css" media="print" onload="this.media='all'" crossorigin="anonymous">

<noscript><link rel="stylesheet" href="/assets/theme.css" crossorigin="anonymous"></noscript>

<script> function gtag_report_conversion(url) { var callback = function () { if (typeof(url) != 'undefined') { window.location = url; } }; gtag('event', 'conversion', { 'send_to': 'AW-955374362/FhacCNqOoMAbEJq2x8cD', 'event_callback': callback }); return false; } </script>

<!-- Fullscreen white cover that fades away after styles load -->
<div id="page-cover"></div>
<style>
  /* Fullscreen white cover for first paint */
  #page-cover{
    position: fixed;
    inset: 0;
    background: #fff;
    opacity: 1;
    transition: opacity .2s ease; /* 200ms fade */
    z-index: 10000; /* above everything */
  }
  /* When fading out */
  #page-cover.is-fading{ opacity: 0; }
</style>

<!-- Minimal critical CSS to reduce FOUC -->
<style id="critical-css">
  html { -webkit-text-size-adjust: 100%; }
  body { margin: 0; line-height: 1.5; font-family: "DM Sans", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; }
  img, svg { display: block; max-width: 100%; height: auto; }
  /* Keep navbar area stable to avoid layout shift before theme loads */
  header.sticky-nav { min-height: 64px; }
  /* Prevent layout jumps for common containers */
  .container { width: 100%; padding-left: 1rem; padding-right: 1rem; margin-left: auto; margin-right: auto; }
  @media (min-width: 992px) { .container { max-width: 960px; } }
  @media (min-width: 1200px) { .container { max-width: 1140px; } }
  @media (min-width: 1400px) { .container { max-width: 1320px; } }
</style>

{{include /components/nav.html}}

<main id="page-content" tabindex="-1">
  {{current_view}}
</main>

{{include /components/footer.html}}

 
<!-- Fullscreen Overlay -->
<div id="fullscreenOverlay" class="overlay hidden">
  <span id="closeBtn" class="close-button">&times;</span>
  <img id="fullscreenImg" class="fullscreen-img" />
</div>
 
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" crossorigin="anonymous">

<script type="text/javascript" src="{{instance.getJsUrl()}}" defer></script>
(** <script type="text/javascript" src="/assets/theme.min.js"></script> **)
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script> 
<script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>

<script>
  (function () {
    var overlay = document.getElementById('fullscreenOverlay');
    var fullscreenImg = document.getElementById('fullscreenImg');
    var closeBtn = document.getElementById('closeBtn');

    function applyTableImageClass(table) {
      var firstRow = table.querySelector('tr');
      if (!firstRow) return;

      var firstCell = firstRow.querySelector('td:first-child');
      var secondCell = firstRow.querySelector('td:nth-child(2)');

      table.classList.remove('has-img-in-col1', 'has-img-in-col2');
      if (firstCell && firstCell.querySelector('img')) {
        table.classList.add('has-img-in-col1');
      } else if (secondCell && secondCell.querySelector('img')) {
        table.classList.add('has-img-in-col2');
      }
    }

    function refreshTables(context) {
      var scope = context || document;
      scope.querySelectorAll('table').forEach(applyTableImageClass);

      var contentTables = Array.prototype.slice.call(document.querySelectorAll('.content table'));
      contentTables.forEach(function (table, index) {
        var firstRow = table.querySelector('tr');
        if (!firstRow) return;

        applyTableImageClass(table);
        table.classList.toggle('alt-table-style', index % 2 === 0);
      }); 
    }

    function bindFullscreenImages(context) {
      if (!overlay || !fullscreenImg) return;
      var scope = context || document;
      scope.querySelectorAll('.content img').forEach(function (img) {
        if (img.dataset.fullscreenBound === 'true') return;
        img.dataset.fullscreenBound = 'true';
        img.addEventListener('click', function () {
          fullscreenImg.src = img.currentSrc || img.src;
          overlay.classList.remove('hidden');
        });
      }); 
    }
 
    function hideOverlay() {
      if (!overlay) return;
      overlay.classList.add('hidden');
    }

    function upgradeLoopingVideos(context) {
      var scope = context || document;
      var preferReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      scope.querySelectorAll('[data-video-src]').forEach(function (wrapper) {
        if (!wrapper || wrapper.dataset.videoAttached) return;
        if (preferReduced) {
          wrapper.dataset.videoAttached = 'reduced';
          return;
        }

        var videoSrc = wrapper.getAttribute('data-video-src');
        if (!videoSrc) {
          wrapper.dataset.videoAttached = 'missing-src';
          return;
        }

        var img = wrapper.querySelector('img');
        if (!img) {
          wrapper.dataset.videoAttached = 'no-img';
          return;
        }

        wrapper.dataset.videoAttached = 'pending';

        var video = document.createElement('video');
        video.className = img.className || '';
        video.classList.remove('h-100');
        if (!video.classList.contains('w-100')) {
          video.classList.add('w-100');
        }
        if (!video.classList.contains('img-fluid')) {
          video.classList.add('img-fluid');
        }
        video.setAttribute('muted', '');
        video.setAttribute('playsinline', '');
        video.setAttribute('autoplay', '');
        video.setAttribute('preload', 'auto');
        video.setAttribute('aria-hidden', 'true');
        video.setAttribute('crossorigin', 'anonymous');
        video.muted = true;
        video.playsInline = true;
        video.preload = 'auto';
        try { video.crossOrigin = 'anonymous'; } catch (_) { /* ignore */ }
        video.style.display = 'block';
        video.style.width = '100%';
        video.style.height = 'auto';
        video.style.objectFit = (img.style && img.style.objectFit) || 'cover';
        video.style.opacity = '0'; 
        video.style.transition = 'opacity .3s ease';
        var naturalWidth = img.naturalWidth || img.width || img.clientWidth;
        var naturalHeight = img.naturalHeight || img.height || img.clientHeight;
        if (!naturalWidth || !naturalHeight) {
          var attrWidth = parseInt(img.getAttribute('width'), 10);
          var attrHeight = parseInt(img.getAttribute('height'), 10);
          if (attrWidth && attrHeight) {
            naturalWidth = attrWidth;
            naturalHeight = attrHeight;
          }
        }  
        if (!naturalWidth || !naturalHeight) {
          naturalWidth = 16;
          naturalHeight = 9;
        }
        var ratio = naturalWidth + ' / ' + naturalHeight;
        video.style.aspectRatio = ratio;
        if (!wrapper.style.aspectRatio) {
          wrapper.style.aspectRatio = ratio;
        }
        // if (!wrapper.style.minHeight) {
        //   var computedHeight = img.clientHeight || img.offsetHeight;
        //   if (computedHeight) {
        //     wrapper.style.minHeight = computedHeight + 'px';
        //   } else {
        //     wrapper.style.minHeight = '320px';
        //   }
        // } 
        try { 
          video.poster = img.currentSrc || img.src;
        } catch (_) {
          video.setAttribute('poster', img.src);
        }

        var source = document.createElement('source');
        source.src = videoSrc;
        source.type = 'video/mp4';
        video.appendChild(source);
        video.src = videoSrc;

        function handleLoadError(error) {
          console.error('Unable to load inline video', error);
          wrapper.dataset.videoAttached = 'error';
          if (video.parentNode) {
            video.parentNode.removeChild(video);
          }
        }

        video.addEventListener('loadeddata', function () {
          if (img && img.parentNode) {
            img.replaceWith(video);
          } else {
            wrapper.appendChild(video);
          }

          wrapper.dataset.videoAttached = 'true';
          requestAnimationFrame(function () {
            video.style.opacity = '1';
          });
          video.loop = false;
          video.play().catch(function (error) {
            console.warn('Autoplay failed; leaving poster in place', error);
          });
        }, { once: true });

        video.addEventListener('ended', function () {
          try { video.pause(); } catch (_) {}
        });

        video.addEventListener('playing', function () {
          video.style.opacity = '1';
        }, { once: true });

        video.addEventListener('error', handleLoadError, { once: true });

        try {
          video.load();
        } catch (_) { /* ignore */ }

        // remain in 'pending' state until loadeddata runs
      });
    }

    function enhanceContent(context) {
      refreshTables(context);
      bindFullscreenImages(context);
      upgradeLoopingVideos(context);
    }

    if (fullscreenImg) {
      fullscreenImg.addEventListener('click', hideOverlay);
    }
    if (closeBtn) {
      closeBtn.addEventListener('click', hideOverlay);
    }
 
    document.addEventListener('DOMContentLoaded', function () {
      enhanceContent(document);
    });

    document.addEventListener('content:updated', function (event) {
      var root = event && event.detail && event.detail.root ? event.detail.root : document;
      enhanceContent(root);
    });
  })();
</script>

<script>
  (function () {
    var cover = document.getElementById('page-cover');
    var themeLink = document.getElementById('theme-css');
    if (!cover || !themeLink) return;

    function fadeAndRemove() {
      // Wait two frames to ensure media flip -> style apply -> paint
      requestAnimationFrame(function () {
        requestAnimationFrame(function () {
          cover.classList.add('is-fading');
          // Remove from DOM when transition finishes, with a 300ms safety timeout
          var done = false;
          function cleanup() {
            if (done) return;
            done = true;
            if (cover && cover.parentNode) cover.parentNode.removeChild(cover);
          }
          cover.addEventListener('transitionend', cleanup, { once: true });
          setTimeout(cleanup, 300);
        });
      });
    }

    // Trigger after theme.css finishes and inline onload flips media='all'
    themeLink.addEventListener('load', function () {
      // Run after the inline onload handler
      setTimeout(fadeAndRemove, 0);
    }, { once: true });

    // If loaded from cache before this script ran
    if (themeLink.media === 'all' || themeLink.sheet) {
      fadeAndRemove();
    }

    // Absolute fallback in case load never fires
    setTimeout(fadeAndRemove, 5000);
  })();
</script>
